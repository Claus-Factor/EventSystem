# Проект "Система генерации и обработки событий"

Проект представляет собой систему генерации и обработки событий, 
с последующей генерацией и хранением инцидентов на основании событий.
реализованную с использованием микросервисной архитектуры на базе Spring Boot.

Система состоит из нескольких модулей:
- `generator` - сервис "Генератор событий" - порт `8080`
- `processor` - сервис "Процессор событий" - порт `8081`
- `event-system` - родительский модуль
- `dependencies_bom` - модуль для подключения общих зависимостей

## Стек технологий

- **Java 21**
- **Spring Boot 3.4.3**
- **PostgreSQL**
- **Hibernate**
- **Feign Client**
- **MapStruct**
- **Docker, Docker Compose**
- **Lombok**
- **Swagger**

## Запуск проекта

**1. Склонировать репозиторий**
```
git clone https://github.com/your-name/restaurant.git
cd event-system
```
**2. Запустить инфраструктуру с помощью Docker Compose**
Отдельные базы данных для каждого сервиса (описаны в файле `docker-compose.yaml`)
```
docker compose up -d
```
**3. Собрать проект**
```
mvn clean install
```
**4. Запустить микросервисы**

Один из способов - запустить каждый из микросервисов в своей IDE.

Альтернативно - с помощью `spring-boot:run`:
```
cd generator
mvn spring-boot:run
```
```
cd processor
mvn spring-boot:run
```

_Если Maven не установлен глобально, используем `mvnw`:_
```
./mvnw spring-boot:run -pl generator
```
```
./mvnw spring-boot:run -pl processor
```

## Доступ к базам данных

В проекте используются две отдельные базы данных PostgreSQL.

- Для микросервиса **generator**:
    - Название базы данных: `generator-service`
    - Порт: `5437`
    - Логин: `root`
    - Пароль: `root`


- Для микросервиса **generator**:
    - Название базы данных: `processor-service`
    - Порт: `5438`
    - Логин: `root`
    - Пароль: `root`

## Взаимодействие микросервисов
Взаимодействие осуществляется через HTTP запросы с использованием FeignClient.
1. Генератор создает события через:
  - Автоматический режим (`@Scheduled`)
  - Ручной вызов через REST API
2. События отправляются в Процессор через `FeignClient`
3. Процессор обрабатывает события по шаблонам:
  - Простой шаблон (события типа 1 -> инцидент типа 1);
  - Составной шаблон (события типа 2 + тип 1 -> инцидент типа 2).

## Тестирование API
Можно использовать Swagger для тестирования API проверки взаимодействия между сервисами.
После запуска сервисов интерактивная документация доступна по адресам:
- Генератор: [http://localhost:8080/swagger-ui.html](http://localhost:8080/swagger-ui.html)
- Процессор: [http://localhost:8081/swagger-ui.html](http://localhost:8081/swagger-ui.html)

**Примеры запросов:**
1) Ручная генерация события
```
POST /api/events/generate?type=TYPE1
Host: localhost:8080
```
2) Получение списка инцидентов:
```
GET /api/incidents?page=0&size=10&sort=time,desc
Host: localhost:8081
```

## Автор

_Николай Вольхин_